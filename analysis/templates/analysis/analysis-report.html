{% load crispy_forms_tags %}

<h5>Report</h5>
<button type="button" class="btn btn-success">Download report</button>
<br>
<br>

<h5>Variant_results</h5>
<table id="variants-table" class="table table-striped table-hover">
  <thead>
    <tr>
      <th style="display:none"></th> <!-- variant PK for JS -->
      <th scope="col">Variant</th>
      <th scope="col">Gene</th>
      <th scope="col">HGVS</th>
      <th scope="col">VAF</th>
      <th scope="col">This run</th>
      <!--<th scope="col">Previously seen</th>-->
      <th scope="col">IGV</th>
    </tr>
  </thead>

  <tbody>
    {% for v in variant_data.variant_calls %}

    #TODO change this to if final decision=="Genuine" once it has been updated
    {% if v.final_decision == "-" %}
    <tr>
      <td class="variant-pk" style="display:none">{{ v.pk }}</td>
      <td>
        <p style="display:inline" id="igv">{{ v.genomic }} </p><button class="btn btn-sm btn-info" onclick="copyToClipboard('#igv')"><span class="fa fa-copy"></span></button>
      </td>
      <td>
        {{ v.gene }}<br>{{ v.exon }}
      </td>
      <td>
        {{ v.transcript }}<br>{{ v.hgvs_c }}<br>{{ v.hgvs_p }}
      </td>
      <td>
        {{ v.vaf.vaf }}%<br>{{ v.vaf.alt_count }} of {{ v.vaf.total_count }} reads
      </td>
      <td>
        {{ v.this_run.count }} of {{ v.this_run.total }} samples<br>
        In NTC: {{ v.this_run.ntc }} {% if v.this_run.ntc == True %}<span class="fa fa-exclamation-triangle" style="color:firebrick"></span>{% endif %}
      </td>



{% if 'IGV' in sample_data.checks.current_status %}

      <td>
        {% for check in v.checks %}
          {{ forloop.counter }}: {{ check }}<br>
        {% endfor %}
      </td>
{% endif %}
{% endif %}
{% endfor %}



<h5>Sign off</h5>

{% if sample_data.checks.current_status != 'Complete' and sample_data.checks.current_status != 'Fail'%}
<div class="card">
  <div class="card-body">

    <h5>Finalise check</h5>
    <br>

    {% crispy submit_form %}

  </div>
</div>
{% endif %}
<br>

<h5>Checks performed</h5>
<table class="table table-bordered">
  <thead>
    <tr>
      <th></th>
      <th>Stage</th>
      <th>User</th>
      <th>Signed off</th>
    </tr>
  </thead>
  <tbody>
    {% for c in sample_data.checks.all_checks %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ c.get_stage_display }}</td>
      <td>{{ c.user }}</td>
      <td>{{ c.signoff_time }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!--<button type="button" class="btn btn-light" data-toggle="modal" data-target="#audit-modal">View full sample audit trail</button>-->

<!-- Modal -->
<div class="modal fade" id="audit-modal" tabindex="-1" role="dialog" aria-labelledby="audit-modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="audit-modalLabel">Audit trail</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
  
          <div class="input-group col-6">
            <input type="text" class="form-control" placeholder="Search" aria-label="Search">
          </div>

          <br>
  
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col">Time</th>
                <th scope="col">User</th>
                <th scope="col">Change</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
            </tbody>
          </table>
  
        </div>
  
      </div>
    </div>
  </div>