{% extends 'analysis/base.html' %}
{% load crispy_forms_tags %}

{% block breadcrumbs %}
<div class="container-fluid breadcrumbs-custom">
  <div class="container">
    <ol class="breadcrumb" style="background-color: transparent;">
      <li class="breadcrumb-item"><a href="{% url 'home' %}"><span class="fa fa-home"></span></a></li>
      <li class="breadcrumb-item active">Self Audit</li>
    </ol>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
  <h5>Checks Performed</h5>
  <br>
  {% if filtered %}
  <div class="alert alert-warning">
    <div class="container">
      <div class="row">
        <div class="col-8">
          {% if query == 'training' %}
          <strong>Showing all non-diagnostic worksheets (training or validation cases)</strong><br>Click to view all worksheets (this will take some time to load).
          {% elif query == 'recent' %}
          <strong>Showing the most recent 30 worksheets</strong><br>Click to view all worksheets (this will take some time to load).
          {% elif query == 'pending' %}
          <strong>Showing all pending worksheets (with at least one sample going through IGV checking)</strong><br>Click to view all worksheets (this will take some time to load).
          {% endif %}
        </div>
        <div class="col-4">
          <a class="btn btn-warning w-100" href="{% url 'self_audit' 'all' %}" role="button">View all</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
<!-- Changed to show the fields that are important for this -->
  <table class="table" id="worksheets-table">
    <thead>
      <tr>
        <th scope="col">WS ID</th>
        <th scope="col">Assay</th>
        <th scope="col">Date Completed</th>
        <th scope="col">Checker</th>
        <th scope="col">Sample ID</th>
        <th scope="col">Comments</th>
        <th scope="col"></th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <!-- {%if user_checks == True
        for ws in worksheets %}??? This kind of thing? -->
      {% for ws in worksheets %}
      {% if user == 'user' and status = 'C'}
      <tr>
        <td>{{ ws.worksheet_id }}</td>
        <td>{{ ws.assay }}</td>
        <td>{{ check.signoff_time}}</td>
        <td>{{ c.user }}</td> 
        <td>{{ ws.sample_id }}</td>
        <td>{{ Check.overall_comment}}</td>
        <td style="text-align:right">
          <a class="btn btn-secondary" href="{% url 'view_ws_samples' ws.worksheet_id %}" role="button">
              View samples
          </a>
        </td>
        <td>{{ ws.samples }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <br>
  <br>

</div>

<script>
    $(document).ready( function() {

        // Inititialise DataTable
        $('#worksheets-table').DataTable({
            paging: true,
            columns: [
                {orderable: true},
                {orderable: true},
                {orderable: true},
                {orderable: true},
                {orderable: true},
                {orderable: false},
                {orderable: false, visible: false}
            ],
            info: true,
            pageLength: 10,
            searching: true,
            aaSorting: [],
            language: {
                searchPlaceholder: "Search by worksheet ID, sample ID, or assay",
                search: "",
            },
            initComplete: function () {
                $('.dataTables_filter input[type="search"]').css({ 'width': '500px', 'display': 'inline-block' });
            }
        });
    } );
</script>

{% endblock %}